<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>API Style Guide Recommendations - {{ service_name }}</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />

    <style>
      .card-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
      }
      .severity-error {
        border-left: 4px solid #dc3545;
        background-color: #f8d7da;
      }
      .severity-warning {
        border-left: 4px solid #ffc107;
        background-color: #fff3cd;
      }
      .compliance-high {
        color: #28a745;
      }
      .compliance-medium {
        color: #ffc107;
      }
      .compliance-low {
        color: #dc3545;
      }
      .field-name {
        font-family: "Courier New", monospace;
        background-color: #f8f9fa;
        padding: 2px 6px;
        border-radius: 3px;
      }
      .suggested-value {
        font-family: "Courier New", monospace;
        background-color: #e7f3ff;
        padding: 2px 6px;
        border-radius: 3px;
      }
      .line-number {
        font-family: "Courier New", monospace;
        background-color: #fff3cd;
        padding: 2px 6px;
        border-radius: 3px;
      }
    </style>
  </head>
  <body>
    <!-- Navigation -->
    <nav
      class="navbar navbar-expand-lg navbar-dark"
      style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%)"
    >
      <div class="container">
        <a class="navbar-brand" href="/">
          <i class="fas fa-code-branch me-2"></i>
          API Governance Platform
        </a>
        <span class="navbar-text">
          <i class="fas fa-lightbulb me-1"></i>
          API Style Guide Recommendations
        </span>
      </div>
    </nav>

    <div class="container mt-4">
      <!-- Service Header -->
      <div class="row mb-4">
        <div class="col-12">
          <div class="card">
            <div class="card-header">
              <h4 class="mb-0">
                <i class="fas fa-cogs me-2"></i>
                {{ service_name }}
              </h4>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-4">
                  <div class="text-center p-3 border rounded">
                    <div
                      class="h3 mb-1 {% if compliance_score >= 80 %}compliance-high{% elif compliance_score >= 60 %}compliance-medium{% else %}compliance-low{% endif %}"
                    >
                      {{ compliance_score }}%
                    </div>
                    <small class="opacity-75">Style Guide Compliance</small>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="text-center p-3 border rounded">
                    <div>
                      <div class="fw-bold">{{ total_fields }}</div>
                      <small class="text-muted">Total API Fields</small>
                    </div>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="text-center p-3 border rounded">
                    <div>
                      <div class="fw-bold text-success">
                        {{ compliant_fields }}
                      </div>
                      <small class="text-muted">Compliant Fields</small>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Recommendations -->
      {% if recommendations %}
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">
            <i class="fas fa-clipboard-list me-2"></i>
            API Style Guide Issues & Recommendations
          </h5>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-hover mb-0">
              <thead class="table-light">
                <tr>
                  <th width="15%">Field Name</th>
                  <th width="15%">Current Naming</th>
                  <th width="15%">Suggested Naming</th>
                  <th width="25%">Description</th>
                  <th width="15%">Rule Violated</th>
                  <th width="10%">Severity</th>
                </tr>
              </thead>
              <tbody>
                {% for rec in recommendations %}
                <tr class="severity-{{ rec.severity }}">
                  <td>
                    <span class="field-name">{{ rec.field_name }}</span>
                  </td>
                  <td>
                    <code>{{ rec.current_naming }}</code>
                  </td>
                  <td>
                    <span class="suggested-value"
                      >{{ rec.suggested_naming }}</span
                    >
                  </td>
                  <td>
                    <small>{{ rec.description }}</small>
                  </td>
                  <td>
                    <small class="text-muted">{{ rec.rule_violated }}</small>
                  </td>
                  <td>
                    <span
                      class="badge {% if rec.severity == 'error' %}bg-danger{% else %}bg-warning{% endif %}"
                    >
                      {% if rec.severity == 'error' %}
                      <i class="fas fa-exclamation-triangle"></i> Error {% else
                      %} <i class="fas fa-exclamation-circle"></i> Warning {%
                      endif %}
                    </span>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
      {% else %}
      <div class="card">
        <div class="card-body">
          <div class="text-center py-5">
            <i
              class="fas fa-check-circle text-success"
              style="font-size: 4rem"
            ></i>
            <h4 class="mt-3 text-success">Fully Compliant!</h4>
            <p class="text-muted">
              This service meets all API style guide requirements.
            </p>
          </div>
        </div>
      </div>
      {% endif %}

      <!-- Actions -->
      <div class="row mt-4">
        <div class="col-12">
          <div class="d-flex gap-2">
            <button class="btn btn-primary" onclick="exportRecommendations()">
              <i class="fas fa-download me-1"></i>
              Export Report
            </button>
            <button class="btn btn-secondary" onclick="copyToClipboard()">
              <i class="fas fa-copy me-1"></i>
              Copy Summary
            </button>
            <a href="/" class="btn btn-outline-secondary">
              <i class="fas fa-arrow-left me-1"></i>
              Back to Dashboard
            </a>
          </div>
        </div>
      </div>

      <!-- Reference -->
      <div class="row mt-4">
        <div class="col-12">
          <div class="alert alert-info">
            <i class="fas fa-lightbulb me-2"></i>
            <strong>Style Guide Reference:</strong>
            These recommendations are based on your customizable API style guide
            rules defined in the Spectral configuration.
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
              // Export recommendations as JSON
              function exportRecommendations() {
                  const data = {
                      service_name: "{{ service_name }}",
                      compliance_score: {{ compliance_score }},
                      total_fields: {{ total_fields }},
                      compliant_fields: {{ compliant_fields }},
                      recommendations: {{ recommendations | tojson }},
                      generated_at: new Date().toISOString()
                  };

                  const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                  const url = URL.createObjectURL(blob);
                  const a = document.createElement('a');
                  a.href = url;
                  a.download = `style-guide-recommendations-{{ service_name }}-${new Date().toISOString().split('T')[0]}.json`;
                  document.body.appendChild(a);
                  a.click();
                  document.body.removeChild(a);
                  URL.revokeObjectURL(url);
              }

              // Copy summary to clipboard
              function copyToClipboard() {
                  const summary = `API Style Guide Summary for {{ service_name }}:
      - Compliance Score: {{ compliance_score }}%
      - Total API Fields: {{ total_fields }}
      - Compliant Fields: {{ compliant_fields }}
      - Issues Found: {{ total_fields - compliant_fields }}
      - Generated: ${new Date().toLocaleString()}`;

                  navigator.clipboard.writeText(summary).then(() => {
                      alert('Summary copied to clipboard!');
                  });
              }
    </script>
  </body>
</html>
